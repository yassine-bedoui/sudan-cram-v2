from typing import TypedDict, List, Dict, Optional, Annotated
from operator import add


class SudanCRAMState(TypedDict):
    # ---- Input from user or API ----
    region: str
    raw_data: Optional[str]           # e.g. a situation report or text to extract events from
    interventions: Optional[List[str]]  # e.g. ["UN mediation", "Ceasefire"]

    # ---- RAG Retrieval ----
    retrieved_events: List[Dict]      # events from Qdrant / vector store

    # ---- Agent Outputs ----
    extracted_events: Optional[Dict]  # structured events from raw_data
    trend_analysis: Optional[Dict]    # escalation / patterns
    scenarios: Optional[Dict]         # policy / intervention scenarios
    validation: Optional[Dict]        # consistency check across outputs

    # ---- Control / Governance ----
    human_approval_required: bool
    approval_status: Optional[str]    # "pending", "auto-approved", etc.

    # ---- Metadata & logging ----
    messages: Annotated[List[str], add]  # LangGraph will merge lists using `add` (concatenate)
    confidence_score: float
    timestamp: str
